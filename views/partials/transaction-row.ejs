<!-- Single transaction row for HTMX updates -->
<div class="transaction-row border-b border-gray-200 hover:bg-gray-50 cursor-pointer" 
     data-transaction-id="<%= transaction.id %>"
     hx-get="/inbox/transaction/<%= transaction.id %>"
     hx-target="#transaction-details-content"
     hx-swap="innerHTML">
    
    <div class="px-6 py-4 flex items-center space-x-4">
        <!-- Checkbox -->
        <input type="checkbox" 
               class="transaction-checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500"
               data-transaction-id="<%= transaction.id %>">
        
        <!-- Transaction Info -->
        <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between mb-1">
                <h3 class="text-sm font-medium text-gray-900 truncate">
                    <%= transaction.description %>
                </h3>
                <span class="text-sm font-semibold text-gray-900">
                    <%= transaction.formattedAmount %>
                </span>
            </div>
            
            <div class="flex items-center space-x-4 text-xs text-gray-500">
                <span class="flex items-center">
                    <i class="fas fa-calendar mr-1"></i>
                    <%= transaction.formattedDate %>
                </span>
                <% if (transaction.merchant) { %>
                <span class="flex items-center">
                    <i class="fas fa-store mr-1"></i>
                    <%= transaction.merchant %>
                </span>
                <% } %>
                <% if (transaction.payment_method) { %>
                <span class="flex items-center">
                    <i class="fas fa-credit-card mr-1"></i>
                    <%= transaction.payment_method %>
                </span>
                <% } %>
            </div>
        </div>
        
        <!-- Status and Category -->
        <div class="flex items-center space-x-3">
            <!-- Category -->
            <% if (transaction.category_id && category) { %>
            <div class="flex items-center px-2 py-1 bg-gray-100 rounded-full">
                <span class="text-xs font-medium text-gray-700"><%= category.name %></span>
            </div>
            <% } %>
            
            <!-- Status -->
            <span class="px-2 py-1 text-xs font-medium rounded-full border status-<%= transaction.status %>">
                <%= transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1) %>
            </span>
            
            <!-- Receipt Indicator -->
            <% if (transaction.receipt_url) { %>
            <i class="fas fa-paperclip text-green-500" title="Has receipt"></i>
            <% } else { %>
            <i class="fas fa-paperclip text-gray-300" title="No receipt"></i>
            <% } %>
            
            <!-- Inline Upload Area -->
            <div class="transaction-upload-area" 
                 data-transaction-id="<%= transaction.id %>"
                 onclick="event.stopPropagation();">
                <input type="file" 
                       id="file-input-<%= transaction.id %>" 
                       accept="image/*,.pdf" 
                       style="display: none;"
                       onchange="handleFileUpload(this, '<%= transaction.id %>')">
                <div class="upload-drop-zone" 
                     ondrop="handleDrop(event, '<%= transaction.id %>')"
                     ondragover="event.preventDefault(); event.currentTarget.classList.add('dragover')"
                     ondragleave="event.currentTarget.classList.remove('dragover')"
                     onclick="document.getElementById('file-input-<%= transaction.id %>').click()">
                    <i class="fas fa-upload"></i>
                    <span>Upload</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.transaction-upload-area {
    margin-top: 0.25rem;
}

.upload-drop-zone {
    border: 1px dashed #d1d5db;
    border-radius: 0.375rem;
    padding: 0.375rem 0.75rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.15s ease-in-out;
    background-color: #f9fafb;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    justify-content: center;
    font-size: 0.75rem;
    color: #6b7280;
}

.upload-drop-zone:hover {
    border-color: #3b82f6;
    background-color: #eff6ff;
    color: #3b82f6;
}

.upload-drop-zone.dragover {
    border-color: #3b82f6;
    background-color: #dbeafe;
    transform: scale(1.02);
}

.upload-drop-zone i {
    font-size: 0.875rem;
}
</style>
