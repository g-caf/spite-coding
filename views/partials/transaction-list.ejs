<% transactions.forEach(transaction => { %>
<article class="transaction-card" 
         data-transaction-id="<%= transaction.id %>"
         hx-get="/inbox/transaction/<%= transaction.id %>"
         hx-target="#transaction-details-content"
         hx-swap="innerHTML"
         onclick="showTransactionDetails('<%= transaction.id %>')">
    
    <div class="transaction-card-content">
        <!-- Checkbox -->
        <input type="checkbox" 
               class="transaction-card-checkbox transaction-checkbox"
               data-transaction-id="<%= transaction.id %>"
               onclick="event.stopPropagation();">
        
        <!-- Main Transaction Info -->
        <div class="transaction-card-main">
            <div class="transaction-card-header">
                <h3 class="transaction-card-description">
                    <%= transaction.description %>
                </h3>
                <div class="transaction-card-amount">
                    <%= transaction.formattedAmount %>
                </div>
            </div>
            
            <div class="transaction-card-meta">
                <div class="transaction-card-meta-item">
                    <i class="fas fa-calendar transaction-card-meta-icon"></i>
                    <span><%= transaction.formattedDate %></span>
                </div>
                <% if (transaction.merchant) { %>
                <div class="transaction-card-meta-item">
                    <i class="fas fa-store transaction-card-meta-icon"></i>
                    <span><%= transaction.merchant %></span>
                </div>
                <% } %>
                <% if (transaction.payment_method) { %>
                <div class="transaction-card-meta-item">
                    <i class="fas fa-credit-card transaction-card-meta-icon"></i>
                    <span><%= transaction.payment_method %></span>
                </div>
                <% } %>
            </div>
        </div>
        
        <!-- Sidebar: Status, Category, Actions -->
        <div class="transaction-card-sidebar">
            <!-- Category -->
            <% if (transaction.category_id) { %>
                <% const category = categories.find(c => c.id === transaction.category_id); %>
                <% if (category) { %>
                <div class="category-pill">
                    <span class="category-pill-icon"><%= category.icon %></span>
                    <span><%= category.name %></span>
                </div>
                <% } %>
            <% } %>
            
            <!-- Status -->
            <div class="status-badge <%= transaction.status %>">
                <%= transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1) %>
            </div>
            
            <!-- Receipt Indicator -->
            <i class="fas fa-paperclip receipt-indicator <%= transaction.receipt_url ? 'has-receipt' : '' %>" 
               title="<%= transaction.receipt_url ? 'Has receipt' : 'No receipt' %>"></i>
            
            <!-- Inline Actions -->
            <div class="transaction-actions">
                <button onclick="event.stopPropagation(); openReceiptModal('<%= transaction.id %>')" 
                        class="transaction-action" 
                        title="Upload receipt">
                    <i class="fas fa-upload"></i>
                </button>
                
                <button onclick="event.stopPropagation(); quickCategorize('<%= transaction.id %>')" 
                        class="transaction-action" 
                        title="Quick categorize">
                    <i class="fas fa-tag"></i>
                </button>
                
                <% if (transaction.status === 'categorized') { %>
                <button onclick="event.stopPropagation(); quickApprove('<%= transaction.id %>')" 
                        class="transaction-action" 
                        title="Quick approve"
                        style="color: var(--color-green);">
                    <i class="fas fa-check"></i>
                </button>
                <% } %>
            </div>
        </div>
    </div>
</article>
<% }); %>

<% if (transactions.length === 0) { %>
<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4rem 2rem; text-align: center;">
    <i class="fas fa-inbox" style="font-size: 4rem; color: var(--color-gray-300); margin-bottom: 1.5rem;"></i>
    <h3 style="font-size: var(--text-lg); font-weight: var(--font-medium); color: var(--color-gray-900); margin-bottom: 0.5rem;">
        No transactions found
    </h3>
    <p style="color: var(--color-gray-500); font-size: var(--text-sm);">
        Try adjusting your search or filters to see more results
    </p>
</div>
<% } %>

<script>
function showTransactionDetails(transactionId) {
    // Show the details panel with smooth animation
    const detailsPanel = document.getElementById('transaction-details');
    detailsPanel.classList.remove('hidden');
    detailsPanel.classList.add('animate-slide-in-right');
    
    // Mark this transaction as selected
    document.querySelectorAll('.transaction-card').forEach(card => {
        card.classList.remove('selected');
    });
    document.querySelector(`[data-transaction-id="${transactionId}"]`).classList.add('selected');
}

function quickCategorize(transactionId) {
    // Create a simple category selection dropdown
    const categories = <%- JSON.stringify(categories) %>;
    const options = categories.map(cat => 
        `<option value="${cat.id}">${cat.icon} ${cat.name}</option>`
    ).join('');
    
    const categoryId = prompt('Choose category:\n' + categories.map((cat, i) => `${i+1}. ${cat.icon} ${cat.name}`).join('\n'));
    
    if (categoryId) {
        htmx.ajax('POST', `/inbox/transaction/${transactionId}/category`, {
            values: { categoryId: categories[parseInt(categoryId)-1]?.id },
            target: `[data-transaction-id="${transactionId}"]`,
            swap: 'outerHTML'
        });
    }
}

function quickApprove(transactionId) {
    htmx.ajax('POST', `/inbox/transaction/${transactionId}/approve`, {
        target: `[data-transaction-id="${transactionId}"]`,
        swap: 'outerHTML'
    });
}
</script>